<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jansora.dao.TopicCatalogDao">
    <resultMap id="CatalogEntity" type="com.jansora.entity.TopicCatalogEntity">
        <result property="id" column="id"/>
        <result property="createAt" column="create_at"/>
        <result property="updateAt" column="update_at"/>
        <result property="ownerId" column="owner_id"/>
        <result property="docId" column="doc_id"/>
        <result property="title" column="title"/>
        <result property="parentId" column="parent_id"/>
        <result property="nodeType" column="node_type"/>
    </resultMap>
    <select id="count" resultType="int">
        SELECT count(1) FROM BLOG_TOPIC_CATALOG WHERE 1 = 1
        <choose><when test="id != null"> AND id = #{id}</when></choose>
        <choose><when test="ownerId != null"> AND owner_id = #{ownerId}</when></choose>
        <choose><when test="docId != null "> AND doc_id = #{docId}</when></choose>
        <choose><when test="parentId != null"> AND parent_id = #{parentId}</when></choose>
        <choose><when test="title != null and title != ''"> AND title = #{title}</when></choose>
        <choose><when test="nodeType != null and nodeType != ''"> AND node_type = #{nodeType}</when></choose>
    </select>
    <select id="find"  resultMap="CatalogEntity">
        SELECT * FROM BLOG_TOPIC_CATALOG WHERE 1 = 1
        <choose><when test="id != null"> AND id = #{id} </when></choose>
        <choose><when test="ownerId != null"> AND owner_id = #{ownerId}</when></choose>
        <choose><when test="docId != null "> AND doc_id = #{docId}</when></choose>
        <choose><when test="parentId != null"> AND parent_id = #{parentId}</when></choose>
        <choose><when test="title != null and title != ''"> AND title = #{title}</when></choose>
        <choose><when test="nodeType != null and nodeType != ''"> AND node_type = #{nodeType}</when></choose>
        ORDER BY
        <choose><when test="orderBy != null and orderBy != '' ">${orderBy} </when><otherwise> update_at </otherwise></choose>
        <choose><when test="sort != null ">${sort </when></choose>
        <choose><when test="limit != null and offset != null"> LIMIT #{limit} OFFSET #{offset} </when></choose>
    </select>
    <select id="findOne"  resultMap="CatalogEntity">
        SELECT * FROM BLOG_TOPIC_CATALOG WHERE 1 = 1
        <choose><when test="id != null"> AND id = #{id} </when></choose>
        <choose><when test="ownerId != null"> AND owner_id = #{ownerId}</when></choose>
        <choose><when test="docId != null "> AND doc_id = #{docId}</when></choose>
        <choose><when test="parentId != null"> AND parent_id = #{parentId}</when></choose>
        <choose><when test="title != null and title != ''"> AND title = #{title}</when></choose>
        <choose><when test="nodeType != null and nodeType != ''"> AND node_type = #{nodeType}</when></choose>
        ORDER BY
        <choose><when test="orderBy != null and orderBy != '' ">${orderBy} </when><otherwise> update_at </otherwise></choose>
        <choose><when test="sort != null ">${sort} </when></choose>

        LIMIT 1;
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO BLOG_TOPIC_CATALOG (
            create_at, update_at,
            owner_id, doc_id, parent_id,
            node_type, title
        )
        VALUES ( NOW(), NOW(), #{ownerId}, #{docId}, #{parentId}, #{nodeType}, #{title} );
    </insert>

    <update id="update" useGeneratedKeys="true" keyProperty="id">
        UPDATE BLOG_TOPIC_CATALOG SET
            update_at = NOW()
        <choose><when test="title != null and title != ''"> , title = #{title}</when></choose>
        <choose><when test="ownerId != null"> , owner_id = #{ownerId}</when></choose>
        <choose><when test="docId != null "> , docId = #{docId}</when></choose>
        <choose><when test="parentId != null"> , parent_id = #{parentId}</when></choose>
        <choose><when test="nodeType != null and nodeType != ''"> , node_type = #{nodeType}</when></choose>
        WHERE id=#{id} ;

    </update>

    <delete id="delete">
        DELETE FROM BLOG_TOPIC_CATALOG WHERE id=#{id} ;
    </delete>
</mapper>